---
title: "[R]기말 정리"
author: "yeoji21"
date: 2021-12-4
categories: [bigdata, R]
tags: [data, bigdata, r]
---

## 문제 1. gapminder 라이브러리를 이용하여 다음 질문에 답하라. (R로 작성한 코드와 실행결과를 제시)

#### 1) gapminder 데이터 프레임의 구성 항목을 조회해보고 설명하라

```r
> install.packages("gapminder")
trying URL 'https://cran.rstudio.com/bin/macosx/contrib/4.1/gapminder_0.3.0.tgz'
Content type 'application/x-gzip' length 2031864 bytes (1.9 MB)
==================================================
downloaded 1.9 MB
The downloaded binary packages are in
	/var/folders/0w/vr0g48zx0z5bhnzwf1d7py680000gn/T//RtmpGtR8mN/downloaded_packages
> library(gapminder)
> gapminder
# A tibble: 1,704 × 6
   country     continent  year lifeExp      pop gdpPercap
   <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows
```
- country : factor with 142 levels
- continent : factor with 5 levels
- year : ranges from 1952 to 2007 in increments of 5 years
- lifeExp : life expectancy at birth, in years
- pop : population
- gdpPercap : GDP per capita (US$, inflation-adjusted)

#### 2) gapminder 데이터에서 각 대륙의 연도별 gdpPercap의 평균값을 플롯하고 범례를 추가하라
```r
> library(dplyr)
> library(ggplot2)
> groupedData = gapminder%>%group_by(year, continent)%>%summarise(avg_gdpPercap = mean(gdpPercap))
`summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
> groupedData
# A tibble: 60 × 3
# Groups:   year [12]
    year continent avg_gdpPercap
   <int> <fct>             <dbl>
 1  1952 Africa            1253.
 2  1952 Americas          4079.
 3  1952 Asia              5195.
 4  1952 Europe            5661.
 5  1952 Oceania          10298.
 6  1957 Africa            1385.
 7  1957 Americas          4616.
 8  1957 Asia              5788.
 9  1957 Europe            6963.
10  1957 Oceania          11599.
# … with 50 more rows
> ggplot(groupedData, aes(x=year, y=avg_gdpPercap, col=continent)) + geom_point()
```

#### 3) gapminder 데이터에서 1인당 gdp에 따른 기대수명을 대륙별로 살펴볼 수 있는 그래프를 작성하라
```r
> gapminder%>%group_by(continent)%>%ggplot(aes(x=gdpPercap, y=lifeExp, col=continent))+geom_point(alpha=0.4)
```
<!-- ```r
> data = gapminder%>%group_by(continent)%>%summarise(gdp_mean=mean(gdpPercap), life=mean(lifeExp))
> data
# A tibble: 5 × 3
  continent gdp_mean  life
  <fct>        <dbl> <dbl>
1 Africa       2194.  48.9
2 Americas     7136.  64.7
3 Asia         7902.  60.1
4 Europe      14469.  71.9
5 Oceania     18622.  74.3
> ggplot(data, aes(x=gdp_mean, y=life, col=continent)) + geom_bar(stat = "identity", aes(fill=continent))
``` -->

#### 4) gapminder 데이터에서 2007년 아시아 대륙의 인구분포를 순위별로 볼 수 있는 그래프를 작성하라.
```r
> gapminder%>%filter(year==2007 & continent=="Asia")%>%ggplot(aes(reorder(country, pop), pop))+geom_bar(stat="identity")+coord_flip()
```

#### 5) gapminder 데이터에서 2007년도 전 세계의 기대수명의 분포 특성을 보여주는 그래프를 작성하라
```r
> gapminder%>%filter(year==2007)%>%ggplot(aes(lifeExp))+geom_histogram()
```

#### 6) gapminder 데이터에서 대륙별로 기대수명의 분포 특성을 보여주는 그래프를 작성하라
```r
> gapminder%>%filter(year==2007)%>%ggplot(aes(continent, lifeExp))+geom_boxplot()
```

#### 7) gapminder 데이터에서 대륙이 아시아일 때, 국가별 기대 수명을 보여주는 막대 그래프를 작성하라.
```r
> gapminder%>%filter(continent=="Asia")%>%ggplot(aes(country, lifeExp))+geom_bar(stat="identity") + coord_flip()
```

#### 8) gapminder 데이터에서 1952년 한국의 기대수명, 인구 수, 1인당 국민 총생산은 얼마인가?
```r
> gapminder%>%filter(country=="Korea, Rep.", year==1952)
# A tibble: 1 × 6
  country     continent  year lifeExp      pop gdpPercap
  <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
1 Korea, Rep. Asia       1952    47.5 20947571     1031.
```

#### 9) gapminder 데이터에서 1952년 이후 연도별 한국의 인구 수와 1인당 국민 총생산을 시각화하는 그래프를 작성하라.
```r
> gapminder%>%filter(country=="Korea, Rep.", year>1952)%>%ggplot(aes(pop, gdpPercap, col=year)) + geom_point()+geom_line()
```

#### 10) gapminder 데이터에서 연도별 국내총생산(gdp)을 계산하여 한국과 쿠웨이트의 gdp 변화를 같은 그래프에 표시하는 그래프를 작성하라.
```r
gapminder%>%filter(country=="Korea, Rep." | country=="Kuwait")%>%mutate(gdp=gdpPercap*pop)%>%ggplot(aes(year, gdp, col=country)) + geom_point() + geom_line()
```

## 문제 2. cars 데이터를 사용하여 다음 질문에 답하시오

#### 1) cars 데이터에서 20, 22, 23번째 샘플을 제거하여 cars1에 저장하시오.
```r
> cars1 = cars[-c(20, 22, 23), ]
> cars1
   speed dist
1      4    2
2      4   10
3      7    4
4      7   22
5      8   16
6      9   10
7     10   18
8     10   26
9     10   34
10    11   17
11    11   28
12    12   14
13    12   20
14    12   24
15    12   28
16    13   26
17    13   34
18    13   34
19    13   46
21    14   36
24    15   20
```

#### 2) cars1 데이터에 speed=26, dist=100이라는 샘플을 추가하여 cars2에 저장하시오.
```r
> cars2 = rbind(cars1, list(26, 100))
> cars2
...
```

#### 3) 새로운 데이터 cars2를 훈련 집합으로 선형 회귀 모형을 구하시오.
```r
> car_model = lm(dist~speed, data=cars2)
> car_model

Call:
lm(formula = dist ~ speed, data = cars2)

Coefficients:
(Intercept)        speed  
    -21.037        4.102  
```

#### 4) 훈련집합 데이터와 선형 회귀 모형을 하나의 그래프로 나타내시오.
```r
> plot(cars2)
> abline(car_model, col='red')
```

#### 5) 이 데이터(cars2)에 대한 통계량을 분석하고, 원래 cars 데이터와 비교하여 해석하시오.
```r
> cars_model = lm(formula = dist ~ speed, data = cars)
> summary(cars_model)

Call:
lm(formula = dist ~ speed, data = cars)

Residuals:
    Min      1Q  Median      3Q     Max 
-29.069  -9.525  -2.272   9.215  43.201 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -17.5791     6.7584  -2.601   0.0123 *  
speed         3.9324     0.4155   9.464 1.49e-12 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 15.38 on 48 degrees of freedom
Multiple R-squared:  0.6511,	Adjusted R-squared:  0.6438 
F-statistic: 89.57 on 1 and 48 DF,  p-value: 1.49e-12

> cars2_model = lm(formula = dist ~ speed, data = cars2)
> summary(cars2_model)

Call:
lm(formula = dist ~ speed, data = cars2)

Residuals:
    Min      1Q  Median      3Q     Max 
-28.999  -8.770  -1.185   7.748  42.593 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  -21.037      6.096  -3.451  0.00121 ** 
speed          4.102      0.366  11.208 9.57e-15 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 14.04 on 46 degrees of freedom
Multiple R-squared:  0.732,	Adjusted R-squared:  0.7261 
F-statistic: 125.6 on 1 and 46 DF,  p-value: 9.574e-15
```

먼저 cars의 모델인 cars_model의 speed계수는 p-value가 1.49e-12이고, cars2의 모델인 cars2_model의 speed계수 p-value는 9.57e-15로 두 모델의 p-value 모두 매우 작은 값을 가지기 때문에 회귀 계수가 유의미하다는 것을 나타낸다. 

하지만 이 모델이 데이터를 얼마나 잘 설명하는지 나타내는 Multiple R-squared 값을 보면, cars_model이 약 65%, cars2_model이 약 73%이므로, cars2_model이 좀 더 나은 모델이라고 볼 수 있다.
