<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[JPA] @OneToOne 연관관계 매핑 시 주의사항" /><meta name="author" content="yeoji21" /><meta property="og:locale" content="en" /><meta name="description" content="이번 포스트에서는 JPA의 @OneToOne 매핑을 사용하면서 마주한 문제에 대해 얘기해보겠습니다." /><meta property="og:description" content="이번 포스트에서는 JPA의 @OneToOne 매핑을 사용하면서 마주한 문제에 대해 얘기해보겠습니다." /><link rel="canonical" href="https://yeoji21.github.io/posts/jpa-one-to-one/" /><meta property="og:url" content="https://yeoji21.github.io/posts/jpa-one-to-one/" /><meta property="og:site_name" content="yeoji21" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-17T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[JPA] @OneToOne 연관관계 매핑 시 주의사항" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@yeoji21" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"yeoji21"},"dateModified":"2022-07-17T00:00:00+09:00","datePublished":"2022-07-17T00:00:00+09:00","description":"이번 포스트에서는 JPA의 @OneToOne 매핑을 사용하면서 마주한 문제에 대해 얘기해보겠습니다.","headline":"[JPA] @OneToOne 연관관계 매핑 시 주의사항","mainEntityOfPage":{"@type":"WebPage","@id":"https://yeoji21.github.io/posts/jpa-one-to-one/"},"url":"https://yeoji21.github.io/posts/jpa-one-to-one/"}</script><title>[JPA] @OneToOne 연관관계 매핑 시 주의사항 | yeoji21</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="yeoji21"><meta name="application-name" content="yeoji21"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@500&display=swap" rel="stylesheet"><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile/img1.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">yeoji21</a></div><div class="site-subtitle font-italic">Don't look back in anger</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/yeoji21" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yeozone0508','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[JPA] @OneToOne 연관관계 매핑 시 주의사항</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[JPA] @OneToOne 연관관계 매핑 시 주의사항</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> yeoji21 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 17, 2022, 12:00 AM +0900" >Jul 17<i class="unloaded">2022-07-17T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2561 words">14 min read</span></div></div><div class="post-content"><p>이번 포스트에서는 JPA의 <code class="language-plaintext highlighter-rouge">@OneToOne</code> 매핑을 사용하면서 마주한 문제에 대해 얘기해보겠습니다.</p><p>결론부터 말씀드리자면 JPA에서 OneToOne 관계로 엔티티를 연결할 경우, <code class="language-plaintext highlighter-rouge">Lazy Loading</code>이 보장되지 않을 수 있습니다.</p><p>어떤 경우에 이런 문제가 발생하고, 어떻게 해결하면 좋을까요?<br /> 문제 상황을 간단히 하면 다음과 같습니다.</p><p><img data-proofer-ignore data-src="/assets/img/spring/shop_erd.png" width="600" /></p><p>하나의 가게는 하나의 가게 위치를 갖습니다.<br /> 이때 가게의 위치는 가게를 지도에 표시하기 위한 위도, 경도 정보를 비롯한 다양한 정보들이 추가될 수 있기 때문에 가게 위치 테이블로 별도로 분리하고 가게와 1:1 연관 관계를 맺고 있습니다.</p><p>여기서 두 엔티티간의 비즈니스적 관계를 보면 가게가 가게 위치를 가지는 주인의 역할을 하기 때문에 가게를 <strong>주인 엔티티</strong>, 가게 위치는 주인 엔티티에 속하는 <strong>대상 엔티티</strong>라고 부르겠습니다.</p><blockquote><p>외래키를 가지는 JPA의 연관 관계의 주인과 무관하게 비즈니스적으로 두 엔티티를 바라본 관계입니다.</p></blockquote><p><br /></p><p>이런 관계에서 저는 대상 엔티티(가게 위치)를 연관 관계의 주인으로 설정했습니다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Location</span><span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"location_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"shop_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Shop</span> <span class="n">shop</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"street_address"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">streetAddress</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>대부분 저처럼 대상 엔티티가 주인 엔티티를 외래키로 가지는 형태로 구상하셨을거라 생각합니다.</p><p>이렇게 구성해야 주인 엔티티(가게)가 저장되고 주인 엔티티의 PK를 FK로 가지는 대상 엔티티(가게 주소)가 저장될 수 있기에 저장이든 조회든 우리의 생각대로 주인 엔티티와 대상 엔티티의 관계가 구현되기 때문입니다.</p><p>여기까지 좋습니다.</p><p>하지만 이렇게 단방향으로 매핑하게되면 대상 엔티티만 주인 엔티티의 참조를 가지게 되는데,<br /> 대부분의 비즈니스 로직에서 가게를 조회하고 가게에서 가게 주소로 접근하는 경우가 많지만 가게는 가게 주소의 참조를 가지고 있지 않기 때문에 접근할 수 있는 방법이 없죠</p><p>따라서 주인 엔티티에서 대상 엔티티의 참조를 가지는 <strong>@OneToOne 양방향 매핑</strong>을 설정합니다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shop</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"shop_name"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">shopName</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"introduction"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">introduction</span><span class="o">;</span>

    <span class="nd">@OneToOne</span><span class="o">(</span>
            <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">,</span>
            <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span>
            <span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"shop"</span>
    <span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Location</span> <span class="n">location</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이제 가게에서도 가게 주소로 접근할 수 있게 되었습니다!<br /> @OneToOne 관계에서 잊지않고 Lazy Loading까지 설정해주었기 때문에 야무지게 두 엔티티의 관계를 매핑했다고 생각했는데..?</p><p>문제는 여기서부터 시작되었습니다 😨😨</p><p>@OneToOne 양방향 매핑을 설정하게 되면 연관 관계의 주인이 아닌 쪽(가게 엔티티)에서는 Lazy Loading을 적용할 수 없게됩니다.</p><blockquote><p>위 예시처럼 명시적으로 fetch = FetchType.LAZY 설정을 추가하더라도 즉시 로딩으로 실행됩니다.</p></blockquote><p><br /></p><p>왜 이런 현상이 발생하는 것일까요?</p><p>JPA는 객체의 참조가 <strong>프록시 기반</strong>으로 동작합니다.</p><p>즉, 지연 로딩을 설정하면 해당 객체의 참조는 비어있는 것이 아니고 프록시 객체를 가지고 있습니다.</p><p>그런데 이때, 조회한 가게에 대한 가게 위치의 결과가 없다면 어떻게 해야할까요? 이 경우에는 당연히 프록시가 아닌 null이 반환되어야 합니다.</p><p>때문에 해당 객체가 null인지 아닌지 체크한 뒤에 null이 아니라면 프록시 객체를 넣어야겠죠</p><blockquote><p>null 체크를 하지 않고 미리 프록시 객체를 넣어둔다면 해당 객체가 존재하지 않더라도 null이 아니라 프록시 객체를 반환해버리기 때문</p></blockquote><p>하지만 지금처럼 대상 엔티티가 연관 관계의 주인인 양방향 매핑 방식에서는 주인 엔티티는 대상 엔티티의 데이터가 존재하는지 스스로 판단이 불가능합니다.</p><p>따라서 이 경우에는 대상 엔티티를 강제로 즉시 로딩해서 데이터가 있으면 해당 데이터를 넣고, 없다면 null을 넣는 방식으로 동작하기 때문에 지연 로딩으로 설정해도 즉시 로딩으로 값을 가져오는 것입니다.</p><p>반대로 연관 관계의 주인 입장에서는 외래키를 관리하고 있기때문에 해당 객체가 존재하는지 스스로 판단할 수 있어 Lazy Loading이 가능합니다.</p><p>그런데 한 가지 의문이 생깁니다.</p><p>@ManyToOne - @OneToMany 양방향 매핑을 한 경우에는 연관 관계의 주인이 아닌 쪽에서도 Lazy Loading을 잘만써왔는데 이 경우는 왜 허용되는 것일까요?</p><p>이 경우에는 단일 객체가 아닌 <strong>컬렉션</strong>을 가지기 때문입니다.<br /> 컬렉션 자체적으로 데이터가 없는 Empty를 표현할 수 있기 때문에 컬렉션의 null 체크를 하지 않아도 됩니다. 따라서 컬렉션은 항상 지연 로딩으로 동작할 수 있는 것이죠</p><p>아주 치밀하게 설계가 되어있구나..라는 생각이 듭니다 🤔</p><p><br /></p><p>다시 예시로 돌아가서 마저 얘기해보겠습니다.</p><p>Lazy Loading을 적용할 수 없다는 것은 꽤나 치명적입니다. 만약 가게 위치를 포함하지 않는 기본적인 가게 정보만 제공하는 API를 개발한다고 했을 때도 필요없는 가게 위치 엔티티까지 조회하게 되죠</p><p>이때 심지어 즉시 로딩으로 인한 N+1 문제가 발생하게 됩니다. 10개의 가게를 조회한다면 11개의 쿼리가 나가고, 100개의 가게를 조회한다면 101개의 쿼리가 나가게 됩니다.</p><p>가게를 조회할 때 항상 fetch join을 통해 가게 위치까지 가져온다면 N+1 문제는 피할 수 있겠지만 가게 위치 데이터를 사용하지 않을 때도 함께 조회해야하는 자원 낭비는 막을 수 없습니다.</p><p>그렇다면 아쉽지만 주인 엔티티에서 대상 엔티티로의 참조를 제거하고 단방향 매핑으로만 사용해볼까요?</p><p>위 예시에서 많은 비즈니스 로직에서 가게와 가게 위치를 함께 사용하게 되는데, 이때마다 가게가 아닌 가게 위치 엔티티를 조회한 뒤, 객체 참조를 통해 가게 엔티티로 접근해야 하기에 객체지향의 관점에서 생각해보면 달갑지 않은 방식입니다.</p><blockquote><p>주인 인티티와 대상 엔티티가 함께 사용되는 경우가 많지 않고, 대상 엔티티는 홀로 사용되는 경우가 대부분이라면 고려해볼 수 있을 것 같습니다.</p></blockquote><p><br /></p><p>그렇다면 어떻게 매핑하는 것이 좋을까요?</p><p>먼저, 정말 1:1 관계가 필요한지 생각해봐야 합니다. 만약 엔티티 간의 관계가 1:N으로 변경될 가능성이 있다면 애초에 1:N으로 설계하는 것도 좋은 방법입니다.</p><p>만약 명확한 1:1 관계라고 생각된다면 주인 엔티티에서 대상 엔티티로 접근하는 비즈니스 로직이 많은지 생각해보고, 대상 엔티티가 주로 단독으로 사용된다면 양방향이 아닌 단방향으로 연결해야 합니다.</p><p>하지만 위 예시처럼 명확한 1:1 관계이면서 주인 엔티티에서 대상 엔티티로 접근하는 비즈니스 로직이 많다면 주인 엔티티가 연관 관계의 주인이 되는 일대일 단방향 매핑으로 설계하는 것이 좋다고 생각합니다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shop</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"shop_name"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">shopName</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"introduction"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">introduction</span><span class="o">;</span>

    <span class="nd">@OneToOne</span><span class="o">(</span>
            <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">,</span>
            <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span>
    <span class="o">)</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"location_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Location</span> <span class="n">location</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 연결하면 주인 테이블에서 대상 테이블의 PK를 FK로 가지기 때문에 문제없이 지연 로딩을 적용할 수 있으면서 주인 엔티티가 대상 엔티티로의 참조를 가지기 때문에 비즈니스 로직 개발 시에도 용이합니다.</p><p>하지만 만약 엔티티 간의 관계가 1:N으로 변경된다면 적용하기가 훨씬 어려워지겠죠. 때문에 이렇게 연결을 하기 전에는 명확한 1:1 매핑이 맞는지 다시 한번 생각해봐야겠습니다.</p><h3 id="참조">참조</h3><ul><li><a href="https://gmoon92.github.io/spring/jpa/hibernate/n+1/2021/01/12/jpa-n-plus-one.html">JPA 성능 N+1 문제와 해결 방법 Moon`s Development Blog</a><li><a href="https://yongkyu-jang.medium.com/jpa-%EB%8F%84%EC%9E%85-onetoone-%EA%B4%80%EA%B3%84%EC%97%90%EC%84%9C%EC%9D%98-lazyloading-%EC%9D%B4%EC%8A%88-1-6d19edf5f4d3">JPA 도입 — OneToOne 관계에서의 LazyLoading 이슈 #1 by Yorath Jang Medium</a><li><a href="https://kwonnam.pe.kr/wiki/java/jpa/one-to-one">java:jpa:one-to-one 권남</a><li><a href="https://www.inflearn.com/questions/224187">연관관계 질문이 있습니다 - 인프런 질문 &amp; 답변</a><li><a href="https://loosie.tistory.com/788">JPA Fetch 전략 공부하기 - @OneToOne 양방향 매핑에서 Lazy가 동작하지 않는 이유</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/orm/'>ORM</a>, <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[JPA] @OneToOne 연관관계 매핑 시 주의사항 - yeoji21&url=https://yeoji21.github.io/posts/jpa-one-to-one/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[JPA] @OneToOne 연관관계 매핑 시 주의사항 - yeoji21&u=https://yeoji21.github.io/posts/jpa-one-to-one/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[JPA] @OneToOne 연관관계 매핑 시 주의사항 - yeoji21&url=https://yeoji21.github.io/posts/jpa-one-to-one/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/polymorphism-inheritance/">객체지향에서의 상속과 다형성</a><li><a href="/posts/graduation-project-review/">졸업 작품 프로젝트 회고</a><li><a href="/posts/reflection-1/">[JAVA] Java Refelction 마스터 강의 1장</a><li><a href="/posts/mst/">[알고리즘] MST - 크루스칼 vs 프림</a><li><a href="/posts/injection/">[Spring] 의존성 주입 시 생성자 주입을 사용해야 하는 이유 </a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag" href="/tags/java-study/">java study</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94-%EC%8A%A4%ED%84%B0%EB%94%94/">자바 스터디</a> <a class="post-tag" href="/tags/oop/">oop</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/guides/">guides</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jpa-basic-1/"><div class="card-body"> <span class="timeago small" >Sep 13, 2021<i class="unloaded">2021-09-13T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA 기초 정리 - 1</h3><div class="text-muted small"><p> 들어가면서 인프런에 있는 김영한님의 자바 ORM 표준 JPA 프로그래밍 - 기본편 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다. 목차 JPA 시작 영속성 관리 엔티티 매핑 연관관계 매핑 기초 다양한 연관관계 매핑 고급 매핑 프록시와 연관관계 관리 J...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-basic-2/"><div class="card-body"> <span class="timeago small" >Sep 19, 2021<i class="unloaded">2021-09-19T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA 기초 정리 - 2</h3><div class="text-muted small"><p> 들어가면서 인프런에 있는 김영한님의 자바 ORM 표준 JPA 프로그래밍 - 기본편 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다. 목차 값 타입 객체지향 쿼리 언어 (JPQL) 값 타입 JPA의 데이터 타입은 크게 두 가지로 분류할 수 있다. 엔티티 타입 ...</p></div></div></a></div><div class="card"> <a href="/posts/spring-data-jpa1/"><div class="card-body"> <span class="timeago small" >Oct 3, 2021<i class="unloaded">2021-10-03T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] Spring Data JPA</h3><div class="text-muted small"><p> 들어가면서 인프런에 있는 김영한님의 실전! 스프링 데이터 JPA 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다. 목차 공통 인터페이스 기능 쿼리 메소드 기능 페이징과 정렬 벌크성 수정 쿼리 @EntityGraph 확장 기능 새로운 엔티티를 구별하는 방법 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/polymorphism-inheritance/" class="btn btn-outline-primary" prompt="Older"><p>객체지향에서의 상속과 다형성</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">yeoji21</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag" href="/tags/java-study/">java study</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94-%EC%8A%A4%ED%84%B0%EB%94%94/">자바 스터디</a> <a class="post-tag" href="/tags/oop/">oop</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/guides/">guides</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://yeoji21.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
