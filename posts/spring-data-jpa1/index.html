<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[JPA] Spring Data JPA" /><meta name="author" content="yeoji21" /><meta property="og:locale" content="en" /><meta name="description" content="들어가면서 인프런에 있는 김영한님의 실전! 스프링 데이터 JPA 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다." /><meta property="og:description" content="들어가면서 인프런에 있는 김영한님의 실전! 스프링 데이터 JPA 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다." /><link rel="canonical" href="https://yeoji21.github.io/posts/spring-data-jpa1/" /><meta property="og:url" content="https://yeoji21.github.io/posts/spring-data-jpa1/" /><meta property="og:site_name" content="yeoji21" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-03T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[JPA] Spring Data JPA" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@yeoji21" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"yeoji21"},"dateModified":"2021-12-26T18:57:41+09:00","datePublished":"2021-10-03T00:00:00+09:00","description":"들어가면서 인프런에 있는 김영한님의 실전! 스프링 데이터 JPA 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다.","headline":"[JPA] Spring Data JPA","mainEntityOfPage":{"@type":"WebPage","@id":"https://yeoji21.github.io/posts/spring-data-jpa1/"},"url":"https://yeoji21.github.io/posts/spring-data-jpa1/"}</script><title>[JPA] Spring Data JPA | yeoji21</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="yeoji21"><meta name="application-name" content="yeoji21"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@500&display=swap" rel="stylesheet"><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile/img1.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">yeoji21</a></div><div class="site-subtitle font-italic">Don't look back in anger</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/yeoji21" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yeozone0508','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[JPA] Spring Data JPA</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[JPA] Spring Data JPA</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> yeoji21 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 3, 2021, 12:00 AM +0900" >Oct 3, 2021<i class="unloaded">2021-10-03T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 26, 2021, 6:57 PM +0900" >Dec 26, 2021<i class="unloaded">2021-12-26T18:57:41+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4090 words">22 min read</span></div></div><div class="post-content"><h2 id="들어가면서">들어가면서</h2><p>인프런에 있는 김영한님의 <a href="https://inf.run/2wyU">실전! 스프링 데이터 JPA</a> 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다.</p><h2 id="목차">목차</h2><ul><li>공통 인터페이스 기능<li>쿼리 메소드 기능<li>페이징과 정렬<li>벌크성 수정 쿼리<li>@EntityGraph<li>확장 기능<li>새로운 엔티티를 구별하는 방법</ul><h3 id="공통-인터페이스-기능"><strong>공통 인터페이스 기능</strong></h3><p>스프링 데이터 JPA가 제공하는 공통 인터페이스를 통해 Repository 생성</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">JpaRepository</code>를 확장한 인터페이스는 스프링 데이터 JPA가 구현 클래스를 대신 생성해서 꽂아준다.</p><p>원래는 <code class="language-plaintext highlighter-rouge">AppConfig</code>에서 <code class="language-plaintext highlighter-rouge">@EnableJpaRepositories</code>를 통해 위치를 지정해주어야 하지만 스프링 부트 사용 시 <code class="language-plaintext highlighter-rouge">@SpringBootApplication</code>이 자동으로 위치를 지정해준다.</p><p>이 때 스프링 데이터 JPA가 컴포넌트 스캔을 자동으로 처리하기 때문에 <code class="language-plaintext highlighter-rouge">@Repository</code>를 생략해도 된다.</p><p>이러한 <code class="language-plaintext highlighter-rouge">JpaRepository</code> 인터페이스는 공통 CRUD 기능을 제공한다.</p><p><img data-proofer-ignore data-src="assets/../../../assets/img/jpa-basic/25.png" width="500" /></p><blockquote><p>그림 오류 T findOne(ID) -&gt; Optional<T> findById(ID)</T></p></blockquote><h4 id="jparepository-주요-메소드">JpaRepository 주요 메소드</h4><ul><li><code class="language-plaintext highlighter-rouge">save(S)</code> : 새로운 엔티티는 저장하고 이미 있는 엔티티는 병합한다.<li><code class="language-plaintext highlighter-rouge">delete(T)</code> : 엔티티 하나를 삭제한다.<li><code class="language-plaintext highlighter-rouge">findById(ID)</code> : 엔티티 하나를 조회한다.<li><code class="language-plaintext highlighter-rouge">getOne(ID)</code> : 엔티티를 프록시로 조회한다.<li><code class="language-plaintext highlighter-rouge">findAll()</code> : 모든 엔티티를 조회한다. 정렬(Sort)이나 페이징(Pageable) 조건을 파라미터로 제공할 수 있다.</ul><h3 id="쿼리-메소드-기능"><strong>쿼리 메소드 기능</strong></h3><p>쿼리 메소드의 기능 3가지</p><ul><li>메소드 이름으로 쿼리 생성<li>메소드 이름으로 <code class="language-plaintext highlighter-rouge">JPA NamedQuery</code> 호출<li><code class="language-plaintext highlighter-rouge">@Query</code> 어노테이션을 사용해서 레포지토리 인터페이스에 쿼리 직접 정의</ul><h4 id="메소드-이름으로-쿼리-생성">메소드 이름으로 쿼리 생성</h4><p>메소드명을 분석해서 자동으로 JPQL 쿼리를 실행한다.</p><p>예를 들어, 순수 JPA 사용 시 이름과 나이를 기준으로 회원을 조회하려고 한다면 아래와 같이 JPQL을 직접 작성한다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsernameAndAgeGreaterThan</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m where m.username=:username "</span> <span class="o">+</span>
              <span class="s">"and m.age &gt;:age"</span><span class="o">,</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">)</span>
              <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span><span class="n">age</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>스프링 데이터 JPA에서는 메소드명만 규칙에 따라 지어주면 된다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsernameAndAgeGreaterThan</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이 때 메소드명으로 사용되는 키워드는 다음과 같다.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: right">키워드<th style="text-align: right">예시<th style="text-align: right">JPQL<tbody><tr><td style="text-align: right">Distinct<td style="text-align: right">findDistinctBy…<td style="text-align: right">select distinct … where …<tr><td style="text-align: right">And<td style="text-align: right">findByNameAndAge<td style="text-align: right">… where x.name =? and x.age =?<tr><td style="text-align: right">Or<td style="text-align: right">findByNameOrNickName<td style="text-align: right">… where x.name = ? or x.nickname = ?<tr><td style="text-align: right">Is, Equals<td style="text-align: right">findByName, findByNameIs,<br />findByNameEquals<td style="text-align: right">… where x.name = ?<tr><td style="text-align: right">Between<td style="text-align: right">findByStartDateBetween<td style="text-align: right">… where x.startDate between ? and ?<tr><td style="text-align: right">LessThan<td style="text-align: right">findByAgeLessThan<td style="text-align: right">… where x.age &lt; ?<tr><td style="text-align: right">LessThanEqual<td style="text-align: right">findByAgeLessThanEqual<td style="text-align: right">… where x.age &lt;= ?<tr><td style="text-align: right">GreaterThan<td style="text-align: right">findByAgeGreaterThan<td style="text-align: right">… where x.age &gt; ?<tr><td style="text-align: right">GreaterThanEqual<td style="text-align: right">findByAgeGreaterThanEqual<td style="text-align: right">… where x.age &gt;= ?<tr><td style="text-align: right">After<td style="text-align: right">findByStartDateAfter<td style="text-align: right">… where x.startDate &gt; ?<tr><td style="text-align: right">Before<td style="text-align: right">findByStartDateBefore<td style="text-align: right">… where x.startDate &lt; ?<tr><td style="text-align: right">IsNull, Null<td style="text-align: right">findByAge(Is)Null<td style="text-align: right">… where x.age is null<tr><td style="text-align: right">IsNotNull, NotNull<td style="text-align: right">findByAge(Is)NotNull<td style="text-align: right">… where x.age not null<tr><td style="text-align: right">Like<td style="text-align: right">findByNameLike<td style="text-align: right">… where x.firstname like ?<tr><td style="text-align: right">NotLike<td style="text-align: right">findByNameNotLike<td style="text-align: right">… where x.firstname not like ?<tr><td style="text-align: right">StartingWith<td style="text-align: right">findByNameStartingWith<td style="text-align: right">… where x.firstname like ? <br /> (parameter bound with appended %)<tr><td style="text-align: right">EndingWith<td style="text-align: right">findByNameEndingWith<td style="text-align: right">… where x.firstname like ? <br /> (parameter bound with prepended %)<tr><td style="text-align: right">Containing<td style="text-align: right">findByNameContaining<td style="text-align: right">… where x.firstname like ? <br /> (parameter bound wrapped in %)<tr><td style="text-align: right">OrderBy<td style="text-align: right">findByAgeOrderByNameDesc<td style="text-align: right">… where x.age = ?1 order by x.name desc<tr><td style="text-align: right">Not<td style="text-align: right">findByNameNot<td style="text-align: right">… where x.lastname &lt;&gt; ?<tr><td style="text-align: right">In<td style="text-align: right">findByAgeIn(Collection&lt;Age&gt; ages)<td style="text-align: right">… where x.age in ?<tr><td style="text-align: right">NotIn<td style="text-align: right">findByAgeNotIn(Collection&lt;Age&gt; ages)<td style="text-align: right">… where x.age not in ?<tr><td style="text-align: right">True<td style="text-align: right">findByActiveTrue()<td style="text-align: right">… where x.active = true<tr><td style="text-align: right">False<td style="text-align: right">findByActiveFalse()<td style="text-align: right">… where x.active = false<tr><td style="text-align: right">IgnoreCase<td style="text-align: right">findByNameIgnoreCase<td style="text-align: right">… where UPPER(x.name) = UPPER(?)</table></div><ul><li>조회 : <code class="language-plaintext highlighter-rouge">find...By</code>, <code class="language-plaintext highlighter-rouge">read...By</code>, <code class="language-plaintext highlighter-rouge">query...By</code>, <code class="language-plaintext highlighter-rouge">get...By</code><ul><li>이 때 <code class="language-plaintext highlighter-rouge">...</code>에는 원하는 식별자명을 자유롭게 사용할 수 있다.</ul><li><p>COUNT : <code class="language-plaintext highlighter-rouge">count...By</code> -&gt; 반환타입 <code class="language-plaintext highlighter-rouge">Long</code></p><li><p>EXISTS : <code class="language-plaintext highlighter-rouge">exists...By</code> -&gt; 반환타입 <code class="language-plaintext highlighter-rouge">boolean</code></p><li><p>삭제 : <code class="language-plaintext highlighter-rouge">delete...By</code>, <code class="language-plaintext highlighter-rouge">remove...By</code> -&gt; 반환타입 <code class="language-plaintext highlighter-rouge">long</code></p><li>LIMIT : <code class="language-plaintext highlighter-rouge">findFirst</code>, <code class="language-plaintext highlighter-rouge">findFirst3</code>, <code class="language-plaintext highlighter-rouge">findTop</code>, <code class="language-plaintext highlighter-rouge">findTop5</code></ul><p>관련된 더 많은 정보는 <a href="https://docs.spring.io/spring-data/jpa/docs/2.5.5/reference/html/#jpa.query-methods">스프링 데이터 JPA 공식 문서</a>를 참조하자.</p><h4 id="query">@Query</h4><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"select m from Member m where m.username= :username and m.age =:age"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findUser</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"username"</span><span class="o">)</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"age"</span><span class="o">)</span><span class="kt">int</span> <span class="n">age</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>실행할 메소드에 정적 쿼리를 직접 작성하기때문에 이름없는 Named 쿼리라고도 볼 수 있다. 그렇기 떄문에 <code class="language-plaintext highlighter-rouge">@Query</code>를 사용해도 JPA named 쿼리처럼 애플리케이션 실행 시점에서 문법 오류를 발견할 수 있다.</p><p>위에서 알아본 메소드명을 통한 자동 쿼리 생성 기능은 파라미터가 많아지면 메소드 이름이 매우 길어지기 때문에 <code class="language-plaintext highlighter-rouge">@Query</code>를 사용하는 경우가 많다.</p><p>이 때 쿼리에 전달할 변수는 <code class="language-plaintext highlighter-rouge">@Param</code>을 통해 파라미터로 전달받는다.</p><h3 id="페이징과-정렬"><strong>페이징과 정렬</strong></h3><p>페이징과 정렬 파라미터</p><ul><li><code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Sort</code><li><code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Pageable</code></ul><p>특별한 반환 타입</p><ul><li><code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Page</code> : 추가 count 쿼리 결과를 포함하는 페이징 방식<li><code class="language-plaintext highlighter-rouge">org.springframework.data.domain.Slice</code> : 추가 count 쿼리 없이 다음 페이지만 확인 가능 (내부적으로 limit+1 조회)<li><code class="language-plaintext highlighter-rouge">List</code> : 추가 count 쿼리 없이 결과만 반환</ul><p>페이징과 정렬 사용 예제</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="nc">Slice</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Sort</span> <span class="n">sort</span><span class="o">);</span>
</pre></table></code></div></div><p>이것을 활용해서 다음 조건으로 페이징과 정렬을 사용하는 예제를 살펴보자.</p><ul><li>검색 조건 : 나이가 10살 이상<li>정렬 조건 : 이름으로 내림차순<li>페이징 조건 : 첫 번째 페이지, 페이지당 보여줄 데이터는 3건</ul><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">pagingTest</span><span class="o">(){</span>
    <span class="c1">//given</span>
    <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member1"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
    <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member2"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
    <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member3"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
    <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member4"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
    <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member5"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
    <span class="nc">PageRequest</span> <span class="n">pageRequest</span> <span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> 
                            <span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">"username"</span><span class="o">));</span>

    <span class="c1">//when</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByAge</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">pageRequest</span><span class="o">);</span>

    <span class="c1">//then</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>   <span class="c1">//조회된 데이터</span>
    <span class="kt">long</span> <span class="n">totalElements</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getTotalElements</span><span class="o">();</span>   

    <span class="n">members</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">totalElements</span><span class="o">);</span>

    <span class="n">assertThat</span><span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>    <span class="c1">//조회된 데이터 수</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getTotalElements</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>   <span class="c1">//전체 데이터 수 </span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>  <span class="c1">//페이지 번호 (0번부터 시작)</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>  <span class="c1">//전체 페이지 수</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">isFirst</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>    <span class="c1">//첫번쨰 항목인지</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>    <span class="c1">//다음 페이지가 있는지</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>메소드의 파라미터로 전달받은 <code class="language-plaintext highlighter-rouge">Pageable</code>은 인터페이스다. 따라서 실제 사용 시에 해당 인터페이스를 구현한 <code class="language-plaintext highlighter-rouge">PageRequest</code> 객체를 사용한다.</p><p><code class="language-plaintext highlighter-rouge">PageRequest</code> 생성자의 첫 번째 파라미터에는 현재 페이지를, 두 번째 파라미터에는 조회할 데이터 수를 입력한다. 추가적으로 정렬 정보도 전달할 수 있다.</p><p><code class="language-plaintext highlighter-rouge">Page</code> 사용 시, 상황에 따라 적절히 카운트 쿼리를 분리해서 조회 성능을 최적화할 수 있다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"select m from Member m left join m.team t"</span><span class="o">,</span> 
                        <span class="n">countQuery</span><span class="o">=</span><span class="s">"select count(m.username) from Member m"</span><span class="o">)</span>
<span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span>
</pre></table></code></div></div><p>이 때, 엔티티를 바로 반환하는 대신, 페이지를 유지하면서 DTO로 반환하기 위해서는 <code class="language-plaintext highlighter-rouge">map()</code>을 사용한다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByAge</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">pageRequest</span><span class="o">);</span>
<span class="nc">Page</span><span class="o">&lt;</span><span class="nc">MemberDto</span><span class="o">&gt;</span> <span class="n">memberDtoPage</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">MemberDto:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="벌크성-수정-쿼리"><strong>벌크성 수정 쿼리</strong></h3><p>스프링 데이터 JPA를 사용한 벌크성 수정 쿼리</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Modifying</span>
<span class="nd">@Query</span><span class="o">(</span><span class="s">"update Member m set m.age = m.age+1 where m.age &gt;=:age"</span><span class="o">)</span>
<span class="kt">int</span> <span class="nf">bulkAgePlus</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"age"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">age</span><span class="o">);</span>
</pre></table></code></div></div><p>벌크성 수정, 삭제 쿼리는 메소드에 <code class="language-plaintext highlighter-rouge">@Modifying</code> 어노테이션을 사용해야 쿼리가 내부적으로 <code class="language-plaintext highlighter-rouge">executeUpdate()</code>로 실행되기 때문에, 추가하지 않으면 예외가 발생한다.</p><p>앞서 JPA 기초에서 배웠듯이, 벌크성 쿼리를 실행하고 나면 꼭 영속성 컨텍스트를 비워줌으로써 DB와 영속성 컨텍스트 내 데이터를 일치시켜야 한다. 스프링 데이터 JPA에서는 <code class="language-plaintext highlighter-rouge">@Modifying(clearAutomatically = true)</code>로 사용하면 벌크 연산 뒤에 영속성 컨텍스트를 자동으로 비워준다.</p><h3 id="entitygraph"><strong>@EntityGraph</strong></h3><p><code class="language-plaintext highlighter-rouge">@EntityGraph</code>는 연관된 엔티티들을 SQL 한 방에 조회하는 방법, 즉 <code class="language-plaintext highlighter-rouge">fecth join</code>을 사용한다.</p><p>JPQL 패치 조인</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nd">@Query</span><span class="o">(</span><span class="s">"select m from Member m join fetch m.team t"</span><span class="o">)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberFetchJoin</span><span class="o">();</span>
</pre></table></code></div></div><p>스프링 데이터 JPA는 JPA가 제공하는 엔티티 그래프 기능을 편리하게 사용하도록 도와준다. 이 어노테이션을 사용하면 JPQL 없이 패치 조인을 사용할 수 있다.</p><blockquote><p>JPQL에도 적용할 수 있다.</p></blockquote><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">//공통 메소드 오버라이드</span>
<span class="nd">@Override</span>
<span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span><span class="o">={</span><span class="s">"team"</span><span class="o">})</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>

<span class="c1">//JPQL + 엔티티 그래프</span>
<span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span><span class="o">={</span><span class="s">"team"</span><span class="o">})</span>
<span class="nd">@Query</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">)</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberEntityGraph</span><span class="o">();</span>

<span class="c1">//메소드 이름으로 쿼리 + 엔티티 그래프</span>
<span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span><span class="o">={</span><span class="s">"team"</span><span class="o">})</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>
</pre></table></code></div></div><p>예시로 확인할 수 있듯이 사실상 패치 조인의 간편 버전이라고 볼 수 있으며, 이 때 내부적으로 <code class="language-plaintext highlighter-rouge">LEFT OUTER JOIN</code>을 사용한다.</p><h3 id="확장-기능"><strong>확장 기능</strong></h3><h4 id="사용자-정의-리포지토리-구현">사용자 정의 리포지토리 구현</h4><p>스프링 데이터 JPA의 리포지토리는 인터페이스만 정의하고 구현체는 스프링이 자동으로 생성해서 꽂아준다.</p><p>이 때 다양한 이유로 인터페이스의 메소드를 직접 구현하고 싶을 수 있는데, 사용자 정의 리포지토리를 구현함으로써 해결할 수 있다.</p><p>사용자 정의 인터페이스</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepositoryCustom</span><span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberCustom</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>사용자 정의 인터페이스 구현 클래스</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryImpl</span> <span class="kd">implements</span> <span class="nc">MemberRepositoryCustom</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemerCustom</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">,</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                 <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>사용자 정의 인터페이스 상속</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> 
                <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">MemberRepositoryCustom</span><span class="o">{</span>
<span class="o">}</span> 
</pre></table></code></div></div><p>사용자 정의 메소드 호출 코드</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findMemberCustom</span><span class="o">();</span>
</pre></table></code></div></div><p>사용자 정의 리포지토리에서 구현체는 <code class="language-plaintext highlighter-rouge">JPA 리포지토리 이름 + Impl</code>로 지어야 한다. 이렇게 지어야 스프링 데이터 JPA가 인식해서 스프링 빈으로 자동 등록한다.따라서 위의 예에서는 항상 사용자 정의 리포지토리 구현체 클래스의 이름은 <code class="language-plaintext highlighter-rouge">MemberRepositoryImpl</code>이어야 한다.</p><p>하지만, 스프링 데이터 2.x 부터는 <code class="language-plaintext highlighter-rouge">사용자 정의 인터페이스명 + Impl</code> 방식도 지원한다. 예를 들어, 위의 예제에서 <code class="language-plaintext highlighter-rouge">MemberRepositoryImpl</code> 대신에 <code class="language-plaintext highlighter-rouge">MemberRepositoryCustomImpl</code>로 구현해도 인식한다.</p><p>사용자 정의 리포지토리는 주로 <code class="language-plaintext highlighter-rouge">QueryDSL</code>이나 <code class="language-plaintext highlighter-rouge">SpringJdbcTemplate</code>을 함께 사용할 때 사용한다. 하지만 항상 사용자 정의 리포지토리를 만들 필요없이, 경우에 따라 핵심 비즈니스 로직과 화면에 맞춘 로직에 따른 리포지토리를 분리하는 것이 좋다.</p><h4 id="auditing">Auditing</h4><p>만약 엔티티를 생성하고 변경할 때, 변경한 사람과 시간을 추적하고 싶다면 등록일, 수정일, 등록자, 수정자를 DB에 함께 저장해야 한다.</p><p><strong>순수 JPA 사용 코드</strong><br /> JPA의 이벤트 어노테이션인 <code class="language-plaintext highlighter-rouge">@PrePersist</code>, <code class="language-plaintext highlighter-rouge">@PostPersist</code>, <code class="language-plaintext highlighter-rouge">@PreUpdate</code>, <code class="language-plaintext highlighter-rouge">@PostUpdate</code>를 사용해서 구현한다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@MappedSuperclass</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaBaseEntity</span> <span class="o">{</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">updatedDate</span><span class="o">;</span>

    <span class="nd">@PrePersist</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prePersist</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="n">createDate</span> <span class="o">=</span> <span class="n">now</span><span class="o">;</span>
        <span class="n">updatedDate</span> <span class="o">=</span> <span class="n">now</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PreUpdate</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preUpdate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">updatedDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><strong>스프링 데이터 JPA 사용</strong><br /> 먼저, 설정을 위해서 <code class="language-plaintext highlighter-rouge">@EnableJpaAuditing</code> 어노테이션을 스프링 부트 설정 클래스에 적용한 뒤, <code class="language-plaintext highlighter-rouge">@EntityListeners(AuditingEntityListener.class)</code>를 엔티티에 적용해야 한다.</p><p>그 후 <code class="language-plaintext highlighter-rouge">@CreatedDate</code>, <code class="language-plaintext highlighter-rouge">@LastModifiedDate</code>, <code class="language-plaintext highlighter-rouge">@CreateBy</code>, <code class="language-plaintext highlighter-rouge">@LastModifiedBy</code> 어노테이션을 사용한다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@EntityListeners</span><span class="o">(</span><span class="nc">AuditingEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@MappedSuperclass</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
    <span class="nd">@CreatedDate</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>

    <span class="nd">@LastModifiedDate</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">lastModifiedDate</span><span class="o">;</span>

    <span class="nd">@CreatedBy</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">;</span>

    <span class="nd">@LastModifiedBy</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastModifiedBy</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>등록자, 수정자를 처리해주는 <code class="language-plaintext highlighter-rouge">AuditorAware</code>를 스프링 빈으로 등록해주어야 한다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@EnableJpaAuditing</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataJpaApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">DataJpaApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">AuditorAware</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">auditorProvider</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>예제를 위해 <code class="language-plaintext highlighter-rouge">UUID</code>를 사용했지만, 실무에서는 세션 정보나 스프링 시큐리티 로그인 정보에서 ID를 받아서 사용한다.</p><h4 id="web-확장---도메인-클래스-컨버터">Web 확장 - 도메인 클래스 컨버터</h4><p>도메인 클래스 컨버터 사용 전</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/members/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">findMember</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>도메인 클래스 컨버터 사용 후</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/member/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">findMember2</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>HTTP 요청은 회원 id를 받지만, 도메인 클래스 컨버터가 동작해서 회원 엔티티 객체를 반환한다. 이 때 도메인 클래스 컨버터도 리포지토리를 사용해서 엔티티를 찾는다.</p><p>주의해야 할 점은 도메인 클래스 컨버터로 엔티티를 파라미터로 직접 받는다면, 이 엔티티는 단순 조회용으로만 사용해야 한다.</p><blockquote><p>트랜잭션이 없는 범위에서 엔티티를 조회했으므로 엔티티를 변경해도 DB에 반영되지 않는다.</p></blockquote><h4 id="web-확장---페이징과-정렬">Web 확장 - 페이징과 정렬</h4><p>스프링 데이터가 제공하는 페이징과 정렬을 스프링 MVC에서도 사용할 수 있다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/members"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 예제처럼 파라미터로 <code class="language-plaintext highlighter-rouge">Pegeable</code>을 받을 수 있다. 이 때 <code class="language-plaintext highlighter-rouge">Pegeable</code> 인터페이스는 <code class="language-plaintext highlighter-rouge">PageRequest</code> 객체를 생성한다.</p><p>이렇게 <code class="language-plaintext highlighter-rouge">Pegeable</code>을 파라미터로 받는 경우, 요청 파라미터를 통해 페이징을 제어할 수 있다.</p><p><code class="language-plaintext highlighter-rouge">http://localhost:8080/members?page=0&amp;size=3&amp;sort=id,desc</code></p><ul><li>page : 현재 페이지, 0부터 시작한다.<li>size : 한 페이지에 노출할 데이터 건수<li>sort : 정렬 조건을 정의</ul><p>매번 요청 파라미터를 전달하지 않아도 기본값을 설정할 수 잇다.</p><ul><li>글로벌 설정 : 스프링 부트<div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>spring.data.eb.pageable.default-page-size=20
spring.data.eb.pageable.max-page-size=2000
</pre></table></code></div></div><li>개별 설정 : <code class="language-plaintext highlighter-rouge">@PageableDefault</code>어노테이션 사용<div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/members"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="o">,</span> <span class="n">sort</span><span class="o">=</span><span class="s">"username"</span><span class="o">,</span> 
                          <span class="n">direction</span><span class="o">=</span><span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><p>이 때, 엔티티를 API로 노출하면 다양한 문제가 발생한다. 그래서 엔티티를 꼭 DTO로 반환해야 한다고 거듭 강조했다. <code class="language-plaintext highlighter-rouge">Page</code>는 <code class="language-plaintext highlighter-rouge">map()</code>을 사용해서 내부 데이터를 변환할 수 있다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/members"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">MemberDto</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="nl">MemberDto:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="새로운-엔티티를-구별하는-방법"><strong>새로운 엔티티를 구별하는 방법</strong></h3><p>스프링 데이터 JPA에서 <code class="language-plaintext highlighter-rouge">save()</code> 메소드는 새로운 엔티티면 <code class="language-plaintext highlighter-rouge">persist()</code>를 호출하지만, 새로운 엔티티가 아니라면 <code class="language-plaintext highlighter-rouge">merge()</code>를 호출한다.</p><p>새로운 엔티티를 판단하는 기본 전략은 다음과 같다.</p><ul><li>식별자가 객체일 때 <code class="language-plaintext highlighter-rouge">null</code>로 판단<li>식별자가 자바 기본 타입일 때 <code class="language-plaintext highlighter-rouge">0</code>으로 판단<li><code class="language-plaintext highlighter-rouge">Persistable</code> 인터페이스를 구현해서 판단 로직 변경 가능</ul><p><strong>Persistable</strong></p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Persistable</span><span class="o">&lt;</span><span class="no">ID</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Nullable</span>
	<span class="no">ID</span> <span class="nf">getId</span><span class="o">();</span>

	<span class="kt">boolean</span> <span class="nf">isNew</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>만약 <code class="language-plaintext highlighter-rouge">Entity</code>의 JPA 식별자 생성 전략이 <code class="language-plaintext highlighter-rouge">@GeneratedValue</code>이면 <code class="language-plaintext highlighter-rouge">save()</code>호출 시점에 식별자가 존재하지 않기때문에 새로운 엔티티로 인식해 <code class="language-plaintext highlighter-rouge">persist()</code>가 호출된다.</p><p>그런데 JPA 생성 전략에 <code class="language-plaintext highlighter-rouge">@Id</code>만 사용해서 직접 할당하는 경우, 이미 식별자 값이 존재하는 상태로 <code class="language-plaintext highlighter-rouge">save()</code>를 호출할 것이다. 따라서 이 경우에는 <code class="language-plaintext highlighter-rouge">merge()</code>가 호출된다. <code class="language-plaintext highlighter-rouge">merge()</code>는 우선 DB에 같은 id를 가진 데이터가 있는지 확인하고, 없으면 새로운 엔티티로 인지하는 로직을 가지기 때문에 매우 비효율적이다.</p><p>따라서 <code class="language-plaintext highlighter-rouge">Persistable</code>을 사용해서 새로운 엔티티 확인 여부를 직접 구현하는 것이 효과적이다. 이 때 등록시간(<code class="language-plaintext highlighter-rouge">@CreatedDate</code>)을 조합해서 이 필드로 새로운 엔티티 여부를 확인하면 편리하다.</p><p><strong>Persistable 구현 예제</strong></p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Getter</span>
<span class="nd">@EntityListeners</span><span class="o">(</span><span class="nc">AuditingEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">implements</span> <span class="nc">Persistable</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@CreatedDate</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Item</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isNew</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createdDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/orm/'>ORM</a>, <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[JPA] Spring Data JPA - yeoji21&url=https://yeoji21.github.io/posts/spring-data-jpa1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[JPA] Spring Data JPA - yeoji21&u=https://yeoji21.github.io/posts/spring-data-jpa1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[JPA] Spring Data JPA - yeoji21&url=https://yeoji21.github.io/posts/spring-data-jpa1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/polymorphism-inheritance/">객체지향에서의 상속과 다형성</a><li><a href="/posts/graduation-project-review/">졸업 작품 프로젝트 회고</a><li><a href="/posts/reflection-1/">[JAVA] Java Refelction 마스터 강의 1장</a><li><a href="/posts/mst/">[알고리즘] MST - 크루스칼 vs 프림</a><li><a href="/posts/injection/">[Spring] 의존성 주입 시 생성자 주입을 사용해야 하는 이유 </a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag" href="/tags/java-study/">java study</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94-%EC%8A%A4%ED%84%B0%EB%94%94/">자바 스터디</a> <a class="post-tag" href="/tags/oop/">oop</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/guides/">guides</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jpa-basic-1/"><div class="card-body"> <span class="timeago small" >Sep 13, 2021<i class="unloaded">2021-09-13T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA 기초 정리 - 1</h3><div class="text-muted small"><p> 들어가면서 인프런에 있는 김영한님의 자바 ORM 표준 JPA 프로그래밍 - 기본편 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다. 목차 JPA 시작 영속성 관리 엔티티 매핑 연관관계 매핑 기초 다양한 연관관계 매핑 고급 매핑 프록시와 연관관계 관리 J...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-basic-2/"><div class="card-body"> <span class="timeago small" >Sep 19, 2021<i class="unloaded">2021-09-19T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA 기초 정리 - 2</h3><div class="text-muted small"><p> 들어가면서 인프런에 있는 김영한님의 자바 ORM 표준 JPA 프로그래밍 - 기본편 강의를 정리한 글입니다. 세부사항이나 설정 등은 포스팅하지 않으니, 자세한 내용은 강의를 통해 확인해주시길 바랍니다. 목차 값 타입 객체지향 쿼리 언어 (JPQL) 값 타입 JPA의 데이터 타입은 크게 두 가지로 분류할 수 있다. 엔티티 타입 ...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-one-to-one/"><div class="card-body"> <span class="timeago small" >Jul 17<i class="unloaded">2022-07-17T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] @OneToOne 연관관계 매핑 시 주의사항</h3><div class="text-muted small"><p> 이번 포스트에서는 JPA의 @OneToOne 매핑을 사용하면서 마주한 문제에 대해 얘기해보겠습니다. 결론부터 말씀드리자면 JPA에서 OneToOne 관계로 엔티티를 연결할 경우, Lazy Loading이 보장되지 않을 수 있습니다. 어떤 경우에 이런 문제가 발생하고, 어떻게 해결하면 좋을까요? 문제 상황을 간단히 하면 다음과 같습니다. 하나의...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/validation/" class="btn btn-outline-primary" prompt="Older"><p>[Spring] Validation</p></a> <a href="/posts/ch01/" class="btn btn-outline-primary" prompt="Newer"><p>클린 코더스 강의 정리 - 1장, 2장 소개 및 OOP</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">yeoji21</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94/">자바</a> <a class="post-tag" href="/tags/java-study/">java study</a> <a class="post-tag" href="/tags/%EC%9E%90%EB%B0%94-%EC%8A%A4%ED%84%B0%EB%94%94/">자바 스터디</a> <a class="post-tag" href="/tags/oop/">oop</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/guides/">guides</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://yeoji21.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
